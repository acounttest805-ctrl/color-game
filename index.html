<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>色覚特性に気づくゲーム</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a5a6a">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" href="icon.png">

    <link rel="stylesheet" href="style.css">

    <style>
        #update-toast {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%); background-color: #28a745;
            color: white; padding: 12px 20px; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 2000;
            display: flex; align-items: center; gap: 15px;
        }
        #update-toast button {
            background-color: white; color: #28a745; border: none;
            padding: 8px 12px; border-radius: 5px; font-weight: bold; cursor: pointer;
        }
        .settings-panel {
            margin-top: 2em; padding: 1em; background-color: #e2e6ea; border-radius: 8px;
        }
        .settings-panel h4 { margin: 0 0 0.5em 0; color: #333; }
        .settings-panel label { display: block; margin-bottom: 0.5em; color: #555; font-size: 0.9em; }
    </style>
</head>
<body>
    <header>
        <h1>色覚特性に気づくゲーム</h1>
        <p>気になるゲームを選んで遊んでみよう！</p>
    </header>

    <main class="home-main">
        <!-- おすすめのゲーム -->
        <section class="genre-carousel">
            <h2 class="genre-title">新着順</h2>
            <div class="carousel-container">
                <div class="game-card coming-soon">
                    <img src="./assets/under-maintenance.png" alt="Color Tetris Legacy（準備中）">
                    <h3>Color Tetris Legacy</h3>
                    <p>過去のシーズンのルールで遊べます。（現在準備中）</p>
                </div>
                <div class="game-card">
                    <a href="./games/color-tetris/index.html">
                        <img src="./assets/color-tetris.png" alt="Color Tetrisのサムネイル">
                        <h3>Color Tetris</h3>
                        <p>落ちてくるブロックを操作し、同じ色を隣接させて消すゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                     <a href="./games/match-the-pattern/index.html">
                        <img src="./assets/match-the-pattern.png" alt="ブロックの色を揃えろ！のサムネイル">
                        <h3>ブロックの色を揃えろ！</h3>
                        <p>見本と同じになるようにブロックの色を揃える記憶力ゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                    <a href="./games/avoid-and-collect/index.html">
                        <img src="./assets/avoid-and-collect.png" alt="Avoid & Collectのサムネイル">
                        <h3>Avoid & Collect</h3>
                        <p>上から降ってくるオブジェクトを避けたり集めたりするゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                    <a href="./games/sort-the-gradient/index.html">
                        <img src="./assets/sort-the-gradient.png" alt="グラデーションを並べ替えろのサムネイル">
                        <h3>グラデーションを並べ替えろ</h3>
                        <p>バラバラのカラーチップを正しい色の順番に並べ替えるゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                    <a href="./games/invisible-path/index.html">
                        <img src="./assets/invisible-path.png" alt="色で見分ける足場のサムネイル">
                        <h3>色で見分ける足場</h3>
                        <p>見えにくい足場を渡ってゴールを目指すアクションゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                    <a href="./games/find-the-color/index.html">
                        <img src="./assets/find-the-color.png" alt="違う色を探せのサムネイル">
                        <h3>違う色を探せ</h3>
                        <p>たくさんの中から一つだけ違う色のタイルを見つけるゲーム。</p>
                    </a>
                </div>
            </div>
        </section>

        <!-- ジャンル1: シンプルな識別ゲーム -->
        <section class="genre-carousel">
            <h2 class="genre-title">シンプルな識別ゲーム</h2>
            <div class="carousel-container">
                <div class="game-card">
                    <a href="./games/find-the-color/index.html">
                        <img src="./assets/find-the-color.png" alt="違う色を探せのサムネイル">
                        <h3>違う色を探せ</h3>
                        <p>たくさんの中から一つだけ違う色のタイルを見つけるゲーム。</p>
                    </a>
                </div>
                <div class="game-card coming-soon">
                    <img src="./assets/ComingSoon.png" alt="準備中のゲーム">
                    <h3>次のゲーム</h3>
                    <p>現在準備中です。</p>
                </div>
            </div>
        </section>

        <!-- ジャンル2: アクションパズル -->
        <section class="genre-carousel">
            <h2 class="genre-title">アクションパズル</h2>
            <div class="carousel-container">
                <div class="game-card">
                    <a href="./games/invisible-path/index.html">
                        <img src="./assets/invisible-path.png" alt="色で見分ける足場のサムネイル">
                        <h3>色で見分ける足場</h3>
                        <p>見えにくい足場を渡ってゴールを目指すアクションゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                    <a href="./games/avoid-and-collect/index.html">
                        <img src="./assets/avoid-and-collect.png" alt="Avoid & Collectのサムネイル">
                        <h3>Avoid & Collect</h3>
                        <p>上から降ってくるオブジェクトを避けたり集めたりするゲーム。</p>
                    </a>
                </div>
                <div class="game-card coming-soon">
                    <img src="./assets/ComingSoon.png" alt="準備中のゲーム">
                    <h3>次のゲーム</h3>
                    <p>現在準備中です。</p>
                </div>
            </div>
        </section>

        <!-- ジャンル3: 思考パズル -->
        <section class="genre-carousel">
            <h2 class="genre-title">思考パズル</h2>
            <div class="carousel-container">
                <div class="game-card">
                    <a href="./games/sort-the-gradient/index.html">
                        <img src="./assets/sort-the-gradient.png" alt="グラデーションを並べ替えろのサムネイル">
                        <h3>グラデーションを並べ替えろ</h3>
                        <p>バラバラのカラーチップを正しい色の順番に並べ替えるゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                     <a href="./games/match-the-pattern/index.html">
                        <img src="./assets/match-the-pattern.png" alt="ブロックの色を揃えろ！のサムネイル">
                        <h3>ブロックの色を揃えろ！</h3>
                        <p>見本と同じになるようにブロックの色を揃える記憶力ゲーム。</p>
                    </a>
                </div>
                <div class="game-card">
                    <a href="./games/color-tetris/index.html">
                        <img src="./assets/color-tetris.png" alt="Color Tetrisのサムネイル">
                        <h3>Color Tetris</h3>
                        <p>落ちてくるブロックを操作し、同じ色を隣接させて消すゲーム。</p>
                    </a>
                </div>
                <div class="game-card coming-soon">
                    <img src="./assets/under-maintenance.png" alt="Color Tetris Legacy（準備中）">
                    <h3>Color Tetris Legacy</h3>
                    <p>過去のシーズンのルールで遊べます。（現在準備中）</p>
                </div>
                <div class="game-card coming-soon">
                    <img src="./assets/ComingSoon.png" alt="準備中のゲーム">
                    <h3>次のゲーム</h3>
                    <p>現在準備中です。</p>
                </div>
            </div>
        </section>
        
    </main>

    <footer>
        <p>【注意】このゲームは医学的な診断を行うものではありません。ご自身の特性について詳しく知りたい場合は、専門の医療機関にご相談ください。</p>
        
        <div class="settings-panel">
            <h4>更新設定</h4>
            <label>
                <input type="radio" name="update-setting" value="manual">
                新しいバージョンがある時に通知する（推奨）
            </label>
            <label>
                <input type="radio" name="update-setting" value="auto">
                常に自動で最新バージョンに更新する
            </label>
        </div>
    </footer>

    <button id="reload-button" onclick="location.reload();">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
    </button>
    
    <script>
      let newWorker;
      function createUpdateUI() {
          if (document.getElementById('update-toast')) return;
          const updateToast = document.createElement('div');
          updateToast.id = 'update-toast';
          updateToast.innerHTML = `
              <span>新しいバージョンが利用可能です。</span>
              <button id="update-btn">更新</button>
          `;
          document.body.appendChild(updateToast);
          document.getElementById('update-btn').addEventListener('click', () => {
              newWorker.postMessage({ action: 'skipWaiting' });
          });
      }
      if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('sw.js').then(reg => {
              reg.addEventListener('updatefound', () => {
                  newWorker = reg.installing;
                  newWorker.addEventListener('statechange', () => {
                      if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                          const updateSetting = localStorage.getItem('updateSetting') || 'manual';
                          if (updateSetting === 'auto') {
                              newWorker.postMessage({ action: 'skipWaiting' });
                          } else {
                              createUpdateUI();
                          }
                      }
                  });
              });
          });
          let refreshing;
          navigator.serviceWorker.addEventListener('controllerchange', () => {
              if (refreshing) return;
              window.location.reload();
              refreshing = true;
          });
      }
      const updateSettingRadios = document.querySelectorAll('input[name="update-setting"]');
      const savedSetting = localStorage.getItem('updateSetting') || 'manual';
      const currentRadio = document.querySelector(`input[value="${savedSetting}"]`);
      if (currentRadio) {
          currentRadio.checked = true;
      }
      updateSettingRadios.forEach(radio => {
          radio.addEventListener('change', (event) => {
              localStorage.setItem('updateSetting', event.target.value);
          });
      });
    </script>
</body>
</html>